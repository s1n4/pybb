{% extends 'pybb/base.html' %}
{% load pybb_extras %}
{% load i18n %}

{% block content %}
<div class="crumbs">
    <a href="{% url index %}">{% trans "Root" %}</a> / {% pybb_link topic.forum.category %} / {% pybb_link topic.forum %} / <strong>{% pybb_link topic %}</strong>
</div>
<ul class="posts">
{% for post in posts %}
    <a name="post-{{ post.id }}"></a>
    <li class="post post-{% cycle "odd" "even" %}">
        <div class="inner">
            <table>
                <tr>
                    <td class="info" width="15%">
                        {% if post.user.pybb_profile.avatar %}
                        <div class="avatar">
                            <a href="{% url pybb_profile post.user %}">
                            <img src="{{ post.user.pybb_profile.avatar.url }}" />
                            </a>
                        </div>
                        {% endif %}
                        <div class="author">{{ post.user|pybb_profile_link }}</div>
                        {% if user.is_superuser %}
                        <!--<div class="updated">{{ post.user_ip }}</div>-->
                        {% endif %}
                        <div class="bottom">
                            <a class="permalink" href="{{ post.get_absolute_url }}">#</a>
                            <span class="updated">{% pybb_time post.created %}</span>
                        </div>
                        {% if user.is_authenticated %}
                        <div class="pm-link">
                            <a href="{% url pybb_create_pm %}?recipient={{ post.user.username }}">{% trans "Send PM" %}</a>
                        </div>
                        {% endif %}
                        <div class="post-controls">
                            {% if moderator or post|pybb_posted_by:user %}
                            <a href="{% url edit_post post.id %}">{% trans "Edit" %}</a>
                            {% endif %}
                            {% if moderator or post|pybb_equal_to:last_post %}
                            {% if moderator or post.user|pybb_equal_to:user %}
                            / <a onclick="return confirm('{% trans "Are you sure you want to delete this post?" %}')" href="{% url delete_post post.id %}">{% trans "Delete" %}</a>
                            {% endif %}
                            {% endif %}
                        </div>
                    </td>
                    <td class="content" width="85%">
                        {{ post.body_html|safe }}
                        {% if not user.is_authenticated or user.pybb_profile.show_signatures %}
                        {% if post.user.pybb_profile.signature %}
                        <div class="signature">
                            {{ post.user.pybb_profile.signature|urlize|linebreaks }}
                        </div>
                        {% endif %}
                        {% endif %}
                        {% if post.updated %}
                        <div class="updated-message">{% trans "Edited" %} {% pybb_time post.updated %}</div>
                        {% endif %}

                        <div class="post-related">
                            <a href="{% url add_post topic.id %}?quote_id={{ post.id }}">{% trans "quote" %}</a>
                        </div>

                    </td>
                </tr>
            </table>
                        <!--<div style="clear: both"></div>-->
        </div>
    </li>
{% endfor %}
</ul>

{% pybb_pagination %}

<div class="controls">
    {% if moderator %}
    {% if topic.sticky %}
    <a href="{% url unstick_topic topic.id %}">{% trans "Unstick topic" %}</a>
    {% else %}
    <a href="{% url stick_topic topic.id %}">{% trans "Stick topic" %}</a>
    {% endif %}
    /
    {% if topic.closed %}
    <a href="{% url open_topic topic.id %}">{% trans "Open topic" %}</a>
    {% else %}
    <a href="{% url close_topic topic.id %}">{% trans "Close topic" %}</a>
    {% endif %}
    /
    {% endif %}
    {% if user.is_authenticated %}
    {% if subscribed %}
    <a href="{% url pybb_delete_subscription topic.id %}?from_topic">{% trans "Unsubscribe" %}</a>
    {% else %}
    <a href="{% url pybb_add_subscription topic.id %}">{% trans "Subscribe" %}</a>
    {% endif %}
    {% endif %}
</div>

{% if not topic.closed %}
<form action="{% url add_post topic.id %}" method="post">
    <fieldset>
        <legend>{% trans "New reply" %}</legend>
        {{ form.as_p }}
        <p><input type="submit" value="{% trans "Submit" %}" /></p>
    </fieldset>
</form>
{% endif %}

{% endblock %}
